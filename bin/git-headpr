#!/bin/bash

set -euo pipefail
set -x

updatepr_args=()
commit_args=()
for arg in "$@"
do
  case "$arg" in
    --squash)
      commit_args+=(-m ignore)
      updatepr_args+=(--squash)
      ;;
    -s)
      commit_args+=(-s)
      updatepr_args+=(-s)
      ;;
    --no-verify)
      commit_args+=(--no-verify)
      ;;
    *)
      echo "error: unexpected argument: $arg"
      exit 1
      ;;
  esac
done

if [[ -z "${commit_args:-}" ]]; then
  commit_args=(--)
fi
if [[ -z "${updatepr_args:-}" ]]; then
  updatepr_args=(--)
fi

head_sha=$(git rev-parse HEAD)
git commit "${commit_args[@]}"
git updatepr "$head_sha" "${updatepr_args[@]}"
