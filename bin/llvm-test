#!/bin/bash

set -euo pipefail
set -x

files=($(git ls-files --modified --others --exclude-standard "$(git rev-parse --show-toplevel)" | grep test))
new_files=()
for file in "${files[@]}"
do
  if [[ -e "$file" ]]; then
    new_files+=("$file")
  fi
done

# Workaround https://stackoverflow.com/a/9988385/902968 with pyenv
python3 ./bin/llvm-lit "${new_files[@]}" "$@"
